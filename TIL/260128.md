# 스파크 개요 및 실행 구조

## 챕터
- 스파크 개요 및 실행구조
- 스파크 설치 및 환경설정

## 하둡 에코시스템
- Hadoop 코어 프로젝트는 HDES, MaoRedurce, Yarn이지만 

## Spark 사용 이유
- 반복 연산에서 Haddop MapReduce보다 빠른 처리 성능


## Spark 활용시 주의점
- 엄밀한 실시간 처비 불가
- 작은 데이터 파일, 처리의 비효율성

## Spark
- Driver: 실행 계획 생성 및 작업 분배
- Cluster Manager: 클러스터 자원 관리
- Worker Nodes: 작업 수행 및 데이터 처리


## Spark의 실행 구조


### Task
- 스테이지를 구성하는 실제 실행 단위

=================

## Spark의 필요성
- 기존 데이터 처리는 주로 단일서버로 이루어짐
- 데이터가 증가하면서 서버 성능을 높이는 방식을 사용
- 단일 서버는 하드웨어의 물리적 한계로 인해 무한정 성능을 높일수 없음

## 디스크 기반 처리로 인한 속도 문제
- Spark 이전의 기술은 데이터를 처리할 때 디스크 기반의 저장장치를 사용
- 디스크는 메모리보다 데이터 읽기/ 쓰기 속도가 현저히 느리기 때문에 데이터 처리 과정에서 속도 저하 현상이 발생

## Spark의 기존 기술의 한계 극복
- Haddop
    - 문제점 느린 처리 속도, 반복 작업 비효율
      -> 메모리 기반 연산

- RDBMS
    - 확장성 부족, 비정형 데이터 처리 어려움
      -> 분산 클러스터 기반, 유연한 스키마

- 특화시스템
    - 기능 분산, 통합 어려움
      -> 하나의 플랫폼에서 배치 + 실시간 + ML

- 디스크 기반 처리
    - 입출력 병목
      -> DAG 기반 최적화 실행, Lazy 평가

## Spark 사용 이유
- 반복 연산에서 Hadoop MapReduce보다 빠른 처리 성능
- 메모리 기반의 데이터 처리로 빠른 속도
- Haddop과의 유연한 연동성
- RDD의 계보를 기반으로 장애 발생시 연산을 자동으로 재실행하여 복구

## Spark의 설계 철학
- 속도
    - 메모리 기반 연산으로 디스크 최소화
    - DAG 기반 스케줄링으로 병렬처리 최적화
    - Tungsten 엔진을 통한 코드 생성 최적화

- 사용 편리성
    - 단일 PC와 클러스터 간 코드 차이가 최소화된 추상화 구조
    - RDD -> DF -> Dataset의 계층적 API 제공
    - Scala, Python, Java, R 등 다중 언어 지원

- 모듈성
    - 다양한 워크로드를 하나의 엔진에서 처리
    - 별도의 시스템 통합 불필요

- 확장성
    - 다양한 데이터 소스 연동
    - 여러 파일 포멧 지원
    - 수많은 서드파티 패키지와 통합 가능

## Spark의 주요 컴포넌트
- Spark Core: 핵심 실행 플랫폼
- Spark SQL: 구조적 데이터 처리 및 SQL 기반 쿼리 실행
- Spark Streaming: 실시간 데이터 분석을 위한 스트리밍 처리
- MLlib: 머신러닝 알고리즘 라이브러리
- GraphX: 그래프 기반 데이터 처리와 분석 지원


## Spark 활용 시 주의점
- 엄밀한 실시간 처리 불가
- 작은 데이터 파일 처리의 비효율성
- 자체 파일 관리 시스템 부재
- 높은 메모리 비용

## 애플리케이션 구성 요소

### 클러스터 매니터
- 애플리케이션 리소스 관리
    - 드라이버가 요청한 실행기 프로세스 시작
    - 실행 중인 프로세스를 중지하거나 재시작
    - 실행자 프로세스가 사용할 수 있는 최대 CPU 코어 개수 제한 등

### 드라이버
- 스파크 애플리케이션의 실행을 관장하고 모니터링
    - 클래스터 매니저에 메모리 및 CPU 리소스를 요청
    - 애플리케이션 로직을 스테이지와 테스크로 분할

### 실행기
- 드라이버로부터 전달받은 테스크를 실행하는 프로세스
    - 스파크 드라이버가 요청한 태스크들을 받아서 실행하고 그 결과를 드라이버로 반환

### 스파크 세션
- 스파크 기능을 사용하기 위한 진입점

### 잡
- 사용자가 실행한 액션에 의해 생성되는 작업 단위

### 스테이지
- 잡을 셔플 기준으로 나눈 실행 단위

### 테스크
- 스테이지를 구성하는 실제 실행 단위